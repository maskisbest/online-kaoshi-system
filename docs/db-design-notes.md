# 数据库优化设计说明（2025-11）

## 目标
- 统一字符集为 `utf8mb4`，避免 emoji/多语言乱码。
- 补齐主键、唯一键、外键、索引，约束数据一致性，减少重复数据。
- 约束字段长度与默认值，降低脏数据概率。
- 保留向后兼容：字段名不变，类型尽量保持；需要强类型（如日期、密码哈希）时在应用层同步修改。

## 变更要点
- **唯一性**：为 `cardId/tel/email` 等实名字段加唯一索引，避免重复账号。
- **角色校验**：`role` 字段增加 CHECK 约束限定 `0/1/2`。
- **试卷与考试**：`paper_manage` 增加自增主键与 `(paperId, questionType, questionId)` 唯一键；`exam_manage.paperId` 唯一，避免同一试卷被多个考试重复绑定。
- **成绩**：`score` 增加 `(examCode, studentId)` 唯一键及外键，防止同一学生同一场考试出现多条成绩。
- **外键**：成绩关联考试与学生，删除考试/学生时联动删除成绩。
- **字符集**：全库转为 `utf8mb4_unicode_ci`。

## 升级脚本
见 `docs/db-upgrade-2025-11.sql`，执行前请先备份现有数据。若存在不符合约束的数据，请先清洗或调整后再执行。

